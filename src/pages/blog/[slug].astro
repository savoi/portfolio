---
import { getCollection, getEntryBySlug } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

const { slug } = Astro.params;
const entry = await getEntryBySlug('blog', slug ?? '');

if (!entry) {
  throw new Error(`Blog post not found for slug: ${slug}`);
}

const { Content } = await entry.render();
const data = entry.data;

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter((post) => !post.data.draft)
    .map((post) => ({
      params: { slug: post.slug },
    }));
}

const badgeClass =
  'inline-flex items-center rounded-full bg-[#588157]/15 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-[#344e41]';
const articleShell =
  'space-y-6 rounded-3xl border border-[#a3b18a]/50 bg-[#dad7cd]/85 p-8 shadow-[0_18px_36px_rgba(52,78,65,0.12)]';
---
<MainLayout title={`${data.title} Â· Blog`} description={data.description} page="blog">
  <article class={articleShell}>
    <header class="space-y-4">
      <p class="inline-flex text-sm font-semibold uppercase tracking-[0.35em] text-[#3a5a40]">
        {new Date(data.publishDate).toLocaleDateString()}
      </p>
      <h1 class="text-3xl font-semibold text-[#344e41]">{data.title}</h1>
      {data.tags.length ? (
        <div class="flex flex-wrap gap-2">
          {data.tags.map((tag) => (
            <span class={badgeClass}>#{tag}</span>
          ))}
        </div>
      ) : null}
    </header>
    <div class="rich-text">
      <Content />
    </div>
  </article>
</MainLayout>
