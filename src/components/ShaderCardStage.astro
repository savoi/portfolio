---
import ShaderWrapper from './ShaderWrapper';

type CardEntry = {
  component: any;          // Astro/React/Svelte component
  props?: Record<string, any>;
  client?: 'load' | 'idle' | 'visible' | 'only';
  key?: string;
};

export interface Props {
  shader?: string;
  shaderQuality?: 'low' | 'medium' | 'high' | 'ultra';
  shaderProps?: Record<string, any>;
  cards?: CardEntry[];
  height?: string;
  maxWidthClass?: string;
  columns?: 1 | 2 | 3;
}

const {
  shader = 'warp',
  shaderQuality = 'high',
  shaderProps = {},
  cards = [],
  height = '520px',
  maxWidthClass = 'max-w-6xl',
  columns = 2,
} = Astro.props as Props;

const gridCols =
  columns === 1
    ? 'grid-cols-1'
    : columns === 3
    ? 'grid-cols-1 md:grid-cols-3'
    : 'grid-cols-1 md:grid-cols-2';
---
<section class="relative w-full overflow-hidden bg-mh-bg" style={{ minHeight: height }}>
  <div class="absolute inset-0">
    <ShaderWrapper
      client:load
      shader={shader}
      quality={shaderQuality}
      className="w-full h-full"
      props={shaderProps}
    />
  </div>

  <div class="absolute inset-0 bg-[radial-gradient(120%_120%_at_50%_30%,color-mix(in_oklch,var(--color-mh-bg)_45%,transparent)_0%,color-mix(in_oklch,var(--color-mh-bg)_0%,transparent)_70%)]" />
  <div class="absolute inset-0 bg-[linear-gradient(180deg,color-mix(in_oklch,var(--color-mh-bg)_54%,transparent)_0%,color-mix(in_oklch,var(--color-mh-bg)_26%,transparent)_60%,transparent_100%)]" />

  <div class="relative z-10 mx-auto px-4 py-10 sm:px-6 lg:px-8">
    <div class={`mx-auto ${maxWidthClass}`}>
      <div class={`grid gap-5 ${gridCols}`}>
        {
          cards.map((entry, i) => {
            const C = entry.component;
            const p = entry.props || {};
            const island =
              entry.client
                ? { [`client:${entry.client}`]: true }
                : {};
            return <C {...p} {...island} />;
          })
        }
      </div>
    </div>
  </div>
</section>
